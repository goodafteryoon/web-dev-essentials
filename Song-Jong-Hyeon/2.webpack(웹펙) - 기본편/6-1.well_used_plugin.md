# 자주 사용하는 플러그인

## banner plugin
- 결과물에 빌드 정보나 커밋 버전 등을 주석으로 추가
- 웹팩 설정 추가
```
const webpack = require('webpack');

module.exports = {
  plugins: [
    new webpack.BannerPlugin({
      banner: '이것은 배너 입니다',
    })
  ]
}
```
- 내장 플러그인이기 때문에 별도의 설치 없이 require로 바로 추가
```
new webpack.BannerPlugin({
  banner: () => `빌드 날짜: ${new Date().toLocaleString()}`,
})
```
- 이렇게 내용을 추가하여 빌드 날짜 등을 추가 가능
- toLocaleString: 사용하는 지역에서 표현된 방식의 문자열로 리턴해주는 자바스크립트 내장 함수

## DefinePlugin
- 개발환경과 배포환경으로 나누어서 운영하는데 도움
- 배포할 때마다 코드를 수정하지 않도록 전역적으로 내용 관리
```
const webpack = require("webpack")

export default {
  plugins: [new webpack.DefinePlugin({
  VERSION: JSON.stringify("v.1.2.3"),
  PRODUCTION: JSON.stringify(false),
  MAX_COUNT: JSON.stringify(999),
  "api.domain": JSON.stringify("http://dev.api.domain.com"),
})],
}
```
- 위와 같이 사용하면 아래 예시에서
```
console.log(VERSION) // 'v.1.2.3'
console.log(PRODUCTION) // true
console.log(MAX_COUNT) // 999
console.log(api.domain) // 'http://dev.api.domain.com'
```
- 전역적으로 변수를 가져다 활용할 수 있다.

## HtmlWebpackPlugin
- html 후처리, 코드 압축 가능
- html 파일이 아웃풋으로 생성 가능하다
- 플러그인 설치
`npm install -D html-webpack-plugin`
- src/index.html
```
<!DOCTYPE html>
<html>
  <head>
    <title>타이틀<%= env %></title>
  </head>
  <body>
    <!-- 로딩 스크립트 제거 -->
    <!-- <script src="dist/main.js"></script> -->
  </body>
</html>
```
- webpack.config.js:
```
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports {
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html', // 템플릿 경로를 지정
      templateParameters: { // 템플릿에 주입할 파라매터 변수 지정
        env: process.env.NODE_ENV === 'development' ? '(개발용)' : '',
      },
    })
  ]
}
```
- process.env.NODE.ENV에 따라서 templateParameters를 변경하고, <%env %>로 나타낸다.
- NODE_ENV=development 빌드하면 빌드결과 "타이틀(개발용)" 
- NODE_ENV=production 빌드하면 빌드결과 "타이틀"로 나온다.

### 응용(주석 제거)
- 배포 버전에서는 파일을 압축하고 주석을 제거하는 것이 좋다.
```
new HtmlWebpackPlugin({
  minify: process.env.NODE_ENV === 'production' ? {
    collapseWhitespace: true, // 빈칸 제거
    removeComments: true, // 주석 제거
  } : false,
})
```

## CleanWebpackPlugin
- 이전 빌드 결과물을 지워주는 플러그인
- 설치
`npm install -D clean-webpack-plugin`
- 설정 webpack.config.js:
```
const { CleanWebpackPlugin } = require("clean-webpack-plugin")

module.exports = {
  plugins: [new CleanWebpackPlugin()],
}
```

## MiniCssExtractPlugin
- 스타일 시트가 커질 수록 css 파일로 분리하는 것이, 브라우져 속도 상 유리하다
- 설치
` npm install -D mini-css-extract-plugin`
- 설정
```
const MiniCssExtractPlugin = require("mini-css-extract-plugin")

module.exports = {
  plugins: [
    ...(process.env.NODE_ENV === "production"
      ? [new MiniCssExtractPlugin({ filename: `[name].css` })]
      : []),
  ],
}
```
- 로더에도 변경점이 필요
```
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          process.env.NODE_ENV === "production"
            ? MiniCssExtractPlugin.loader // 프로덕션 환경
            : "style-loader", // 개발 환경
          "css-loader",
        ],
      },
    ],
  },
}
```
